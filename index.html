<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pagamento via PIX</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrious/4.0.2/qrious.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; margin: 20px; }
        #qr-code, #confirmarPagamento, #nota-fiscal { display: none; margin-top: 20px; }
        #nota-fiscal { border: 1px solid #000; padding: 10px; }
    </style>
</head>
<body>

    <h2>Gerar Pagamento via PIX</h2>

    <h3>Dados do Cliente</h3>
    <label>Nome do Cliente:</label>
    <input type="text" id="cliente" placeholder="Nome Completo"><br><br>

    <label>CPF/CNPJ:</label>
    <input type="text" id="cpf" placeholder="000.000.000-00"><br><br>

    <label>Valor (R$):</label>
    <input type="number" id="valor" placeholder="0.00"><br><br>

    <h3>Dados da Agência</h3>
    <label>Chave PIX da Agência:</label>
    <input type="text" id="chavePix" placeholder="E-mail, CPF, CNPJ ou Telefone"><br><br>

    <button onclick="gerarQRCode()">Gerar QR Code PIX</button>

    <canvas id="qr-code"></canvas>

    <button id="confirmarPagamento" onclick="gerarNotaFiscal()">Confirmar Pagamento</button>

    <div id="nota-fiscal">
        <h3>Nota Fiscal</h3>
        <p><strong>Cliente:</strong> <span id="nf-cliente"></span></p>
        <p><strong>CPF/CNPJ:</strong> <span id="nf-cpf"></span></p>
        <p><strong>Valor:</strong> R$ <span id="nf-valor"></span></p>
        <p><strong>Data:</strong> <span id="nf-data"></span></p>
        <p><strong>Hora:</strong> <span id="nf-hora"></span></p>
        <button onclick="baixarNotaFiscal()">Baixar Nota Fiscal</button>
    </div>

    <script>
        function gerarQRCode() {
            const cliente = document.getElementById("cliente").value;
            const cpf = document.getElementById("cpf").value;
            const valor = document.getElementById("valor").value;
            const chavePix = document.getElementById("chavePix").value;

            if (!cliente || !cpf || !valor || !chavePix) {
                alert("Preencha todos os campos!");
                return;
            }

            // Gerando o código PIX Copia e Cola no formato oficial do Banco Central
            const payload = `00020126330014BR.GOV.BCB.PIX0114${chavePix}520400005303986540${valor}5802BR5925Nome da Agência6008BRASIL62070503***`;

            // Criando QR Code apenas agora
            const qr = new QRious({ element: document.getElementById("qr-code"), value: payload, size: 200 });

            // Exibindo o QR Code e o botão de confirmação
            document.getElementById("qr-code").style.display = "block";
            document.getElementById("confirmarPagamento").style.display = "block";
        }

        function gerarNotaFiscal() {
            const cliente = document.getElementById("cliente").value;
            const cpf = document.getElementById("cpf").value;
            const valor = document.getElementById("valor").value;
            const dataAtual = new Date();

            document.getElementById("nf-cliente").textContent = cliente;
            document.getElementById("nf-cpf").textContent = cpf;
            document.getElementById("nf-valor").textContent = valor;
            document.getElementById("nf-data").textContent = dataAtual.toLocaleDateString();
            document.getElementById("nf-hora").textContent = dataAtual.toLocaleTimeString();

            // Exibir a nota fiscal
            document.getElementById("nota-fiscal").style.display = "block";
        }

        function baixarNotaFiscal() {
            const cliente = document.getElementById("nf-cliente").textContent;
            const cpf = document.getElementById("nf-cpf").textContent;
            const valor = document.getElementById("nf-valor").textContent;
            const data = document.getElementById("nf-data").textContent;
            const hora = document.getElementById("nf-hora").textContent;

            const notaFiscalTexto = `
                Nota Fiscal\n
                -------------------------\n
                Cliente: ${cliente}\n
                CPF/CNPJ: ${cpf}\n
                Valor: R$ ${valor}\n
                Data: ${data}\n
                Hora: ${hora}\n
                -------------------------\n
                Obrigado por seu pagamento!
            `;

            const blob = new Blob([notaFiscalTexto], { type: "text/plain" });
            const link = document.createElement("a");
            link.href = URL.createObjectURL(blob);
            link.download = "Nota_Fiscal.txt";
            link.click();
        }
    </script>

</body>
</html>
